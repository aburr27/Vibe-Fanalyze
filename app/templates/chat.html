<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VibeBot | Vibe-Fanalyze Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/charts.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #0d1117; color: #fff; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        h1 { margin-top: 20px; }
        .chat-container { display: flex; flex-direction: row; gap: 20px; margin-top: 30px; }
        .chat-box { flex: 1; background: #161b22; padding: 20px; border-radius: 12px; height: 500px; overflow-y: auto; }
        .message { margin: 10px 0; padding: 10px; border-radius: 8px; }
        .user { background: #238636; text-align: right; }
        .bot { background: #30363d; text-align: left; }
        .input-area { margin-top: 10px; }
        input { width: 75%; padding: 10px; border: none; border-radius: 8px; }
        button { padding: 10px 20px; background: #1f6feb; border: none; border-radius: 8px; color: white; cursor: pointer; }
        button:hover { background: #388bfd; }
        .chart-panel { flex: 1; background: #161b22; padding: 20px; border-radius: 12px; display: flex; flex-direction: column; gap: 20px; }
        canvas { background: #0d1117; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>ðŸ¤– VibeBot Analytics Chat</h1>

    <div class="chat-container">
        <div class="chat-box" id="chat-box"></div>
        <div class="chart-panel">
            <canvas id="winChart"></canvas>
            <canvas id="bankrollChart"></canvas>
        </div>
    </div>

    <div class="input-area">
        <input id="user-input" placeholder="Ask about a matchup or betting odds...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VibeBot Chat</title>
<link rel="stylesheet" href="/static/styles.css">
<script src="/static/chat.js" defer></script>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen">
<header class="p-4 text-2xl font-bold text-center bg-gray-800">ðŸ’¬ VibeBot Chat</header>

<main class="flex-1 flex flex-col md:flex-row">
    <!-- Chat Interface -->
    <section class="flex-1 p-6">
    <div id="chat-box" class="h-[70vh] overflow-y-auto bg-gray-800 p-4 rounded-xl shadow-lg">
        {% for chat in chats %}
        <div class="mb-4">
            <p><strong>You:</strong> {{ chat.user_message }}</p>
            <p class="text-green-400"><strong>VibeBot:</strong> {{ chat.bot_response }}</p>
        </div>
        {% endfor %}
    </div>
    <div class="mt-4 flex gap-2">
        <input id="user-input" class="flex-1 p-2 rounded bg-gray-700 text-white" placeholder="Ask about a team or bet..." />
        <button id="send-btn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">Send</button>
    </div>
    </section>

    <!-- History Panel -->
    <aside class="w-full md:w-1/3 bg-gray-800 p-6 border-l border-gray-700">
    <h2 class="text-xl mb-4 font-semibold">ðŸ“œ Recent History</h2>
    <div id="history" class="overflow-y-auto h-[70vh]">
        {% for chat in chats %}
        <div class="mb-4 border-b border-gray-700 pb-2">
            <p class="text-sm text-gray-300"><strong>You:</strong> {{ chat.user_message }}</p>
            <p class="text-xs text-green-400"><strong>VibeBot:</strong> {{ chat.bot_response }}</p>
        </div>
        {% endfor %}
    </div>
    </aside>
</main>
</body>
</html>

    <script>
        async function sendMessage() {
            const input = document.getElementById("user-input");
            const message = input.value.trim();
            if (!message) return;

            appendMessage(message, "user");
            input.value = "";

            const res = await fetch("/api/vibebot", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_query: message })
            });

            const data = await res.json();
            appendMessage(data.response, "bot");

            // If VibeBot returned data for analytics
            if (data.data) {
                const ctx1 = document.getElementById("winChart").getContext("2d");
                const ctx2 = document.getElementById("bankrollChart").getContext("2d");

                if (data.data.win_prob_a && data.data.win_prob_b)
                    renderWinProbChart(ctx1, data.data);

                if (data.data.bet_size)
                    renderBankrollChart(ctx2, data.data);
            }
        }

        function appendMessage(text, sender) {
            const box = document.getElementById("chat-box");
            const div = document.createElement("div");
            div.className = `message ${sender}`;
            div.innerText = text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
